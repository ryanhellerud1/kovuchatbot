# AI Chatbot Project - Developer Guide

## Project Overview

This is **KovuChatbot**, an advanced AI chatbot application built with Next.js and the AI SDK. The project is a fork/customization of Vercel's AI Chatbot template, featuring artifact generation, document management, and multi-modal interactions.

### Key Technologies
- **Framework**: Next.js 15 (App Router, React Server Components)
- **Language**: TypeScript
- **Styling**: Tailwind CSS with shadcn/ui components
- **Database**: PostgreSQL with Drizzle ORM
- **Authentication**: NextAuth.js v5 (beta)
- **AI**: AI SDK with xAI (Grok) as default provider
- **Testing**: Playwright for E2E testing
- **Code Quality**: Biome for linting and formatting
- **Package Manager**: pnpm

## Architecture Overview

### App Structure
- `app/(auth)/` - Authentication routes (login, register)
- `app/(chat)/` - Main chat interface and API routes
- `artifacts/` - Artifact system (text, code, image, sheet)
- `components/` - Reusable React components
- `lib/` - Utilities, database, AI configuration
- `tests/` - Playwright test suites

### Key Features
- **Artifacts System**: Generate and edit documents, code, images, and spreadsheets
- **Chat History**: Persistent conversation storage
- **File Uploads**: Support for document attachments
- **Real-time Streaming**: AI responses with streaming support
- **Guest Mode**: Anonymous usage capability
- **Responsive Design**: Mobile-first with sidebar navigation

## Development Guidelines

### Code Style and Formatting
- Use **Biome** for linting and formatting (configured in `biome.jsonc`)
- Follow the existing TypeScript strict configuration
- Use single quotes for strings, trailing commas
- 2-space indentation, 80-character line width
- JSX double quotes, preserve semicolons

### Component Patterns
- Use React Server Components where possible
- Implement proper TypeScript typing with interfaces
- Follow shadcn/ui component patterns for consistency
- Use `'use client'` directive only when necessary
- Prefer composition over inheritance

### Database Patterns
- Use Drizzle ORM with PostgreSQL
- Schema defined in `lib/db/schema.ts`
- Migrations in `lib/db/migrations/`
- Database queries in `lib/db/queries.ts`
- Run migrations with `pnpm db:migrate`

### AI Integration
- Default model: `chat-model-reasoning-qwen3` (Kovu AI Deep Think)
- AI tools defined in `lib/ai/tools/`
- Streaming responses with data stream handlers
- Support for multi-modal inputs (text, images, files)

### Artifact System
- Four artifact types: text, code, image, sheet
- Client components in `artifacts/{type}/client.tsx`
- Server handlers in `artifacts/{type}/server.ts`
- Document creation/update through AI tools
- Real-time collaborative editing capabilities

## File Organization

### Important Configuration Files
- `next.config.ts` - Next.js configuration with PPR enabled
- `drizzle.config.ts` - Database configuration
- `middleware.ts` - Authentication and routing middleware
- `tailwind.config.ts` - Tailwind CSS customization
- `biome.jsonc` - Code quality configuration
- `playwright.config.ts` - E2E testing setup

### Key Directories
- `components/ui/` - shadcn/ui components (don't modify directly)
- `lib/ai/` - AI models, providers, and tools
- `lib/db/` - Database schema, queries, and migrations
- `hooks/` - Custom React hooks
- `tests/` - E2E and route testing

## Development Workflow

### Environment Setup
1. Copy `.env.example` to `.env.local`
2. Set required environment variables:
   - `AUTH_SECRET` - Authentication secret
   - `XAI_API_KEY` - xAI API key
   - `POSTGRES_URL` - Database connection
   - `BLOB_READ_WRITE_TOKEN` - Vercel Blob storage

### Common Commands
```bash
pnpm dev              # Start development server
pnpm build            # Build for production
pnpm db:generate      # Generate database migrations
pnpm db:migrate       # Run database migrations
pnpm db:studio        # Open Drizzle Studio
pnpm lint             # Run linting
pnpm lint:fix         # Fix linting issues
pnpm format           # Format code with Biome
pnpm test             # Run Playwright tests
```

### Database Development
- Use `pnpm db:generate` after schema changes
- Always review generated migrations before applying
- Use `pnpm db:studio` for database inspection
- Follow the existing naming conventions for tables and columns

### Testing Guidelines
- Write E2E tests for critical user flows
- Test files in `tests/e2e/` and `tests/routes/`
- Use page object pattern for test organization
- Mock external API calls in tests
- Ensure tests work with guest authentication

## Best Practices

### Performance
- Leverage React Server Components for data fetching
- Use Partial Prerendering (PPR) where beneficial
- Implement proper loading states and skeletons
- Optimize images with Next.js Image component
- Use SWR for client-side data fetching

### Security
- Validate all user inputs with Zod schemas
- Use server actions for mutations
- Implement proper CSRF protection
- Sanitize user-generated content
- Follow NextAuth.js security best practices

### Accessibility
- Use semantic HTML elements
- Implement proper ARIA attributes
- Ensure keyboard navigation works
- Test with screen readers
- Follow WCAG guidelines

### Error Handling
- Implement proper error boundaries
- Use try-catch blocks in server actions
- Provide meaningful error messages
- Log errors appropriately
- Handle network failures gracefully

## Deployment

### Vercel Deployment
- Automatic deployments from main branch
- Environment variables configured in Vercel dashboard
- Database migrations run automatically after build
- Blob storage and PostgreSQL provisioned through Vercel

### Environment Variables
- Use Vercel's environment variable management
- Never commit `.env` files to version control
- Use different environments for staging/production
- Rotate secrets regularly

## Troubleshooting

### Common Issues
- **Build failures**: Check TypeScript errors and dependency versions
- **Database issues**: Verify connection string and migration status
- **Authentication problems**: Check AUTH_SECRET and provider configuration
- **AI responses**: Verify API keys and model availability
- **Styling issues**: Check Tailwind CSS compilation and custom CSS

### Debug Tools
- Use Next.js built-in debugging
- Drizzle Studio for database inspection
- Browser dev tools for client-side issues
- Vercel logs for production debugging
- Playwright trace viewer for test failures

## Contributing

### Code Review Guidelines
- Ensure all tests pass
- Follow the established code style
- Update documentation when needed
- Test accessibility features
- Verify mobile responsiveness

### Pull Request Process
1. Create feature branch from main
2. Implement changes with tests
3. Run full test suite
4. Update relevant documentation
5. Submit PR with clear description

## Additional Resources

- [Next.js Documentation](https://nextjs.org/docs)
- [AI SDK Documentation](https://sdk.vercel.ai/docs)
- [Drizzle ORM Documentation](https://orm.drizzle.team/)
- [shadcn/ui Documentation](https://ui.shadcn.com/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)